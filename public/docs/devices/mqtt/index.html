<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>IoT Labs</title>

    <!-- Custom fonts for this template-->
    <link href="../../vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <link
        href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
        rel="stylesheet">

    <!-- Custom styles for this template-->
    <link href="../../css/sb-admin-2.min.css" rel="stylesheet">

    <link rel="stylesheet" href="../../../assets/css/imt.css">

    <link rel="stylesheet" href="../../css/codeFormatting.css">
</head>

<body id="page-top">

    <!-- Page Wrapper -->
    <div id="wrapper">

        <!-- Sidebar -->
        <ul class="navbar-nav bg-dark sidebar sidebar-dark accordion" id="accordionSidebar">

            <!-- Sidebar - Brand -->
            <a class="sidebar-brand d-flex align-items-center justify-content-center" href="/docs">
                <div class="sidebar-brand-icon">
                    <img src="../../../assets/img/imt-Logo.jpg" height="70rem">
                </div>
                <div class="sidebar-brand-text mx-3">IoT Labs</sup></div>
            </a>

            <!-- Divider -->
            <hr class="sidebar-divider my-0">

            <!-- Nav Item - Dashboard -->
            <li class="nav-item">
                <a class="nav-link" href="/docs">
                    <!-- <i class="fas fa-fw fa-tachometer-alt"></i> -->
                    <span>Introducción</span></a>
            </li>

            <!-- Divider -->
            <hr class="sidebar-divider">

            <!-- Heading -->
            <div class="sidebar-heading">
                API
            </div>

            <!-- Nav Item - Pages Collapse Menu -->
            <li class="nav-item">
                <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseTwo"
                    aria-expanded="true" aria-controls="collapseTwo">
                    <img src="../../../assets/img/icons/app.white.svg">
                    <span>Aplicaciones</span>
                </a>
                <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordionSidebar">
                    <div class="bg-white py-2 collapse-inner rounded">
                        <a class="collapse-item" href="/docs/apps/intro/">Introducción</a>
                        <a class="collapse-item" href="/docs/apps/editor/">Editor</a>
                        <a class="collapse-item" href="/docs/apps/layout/">Layout</a>
                        <a class="collapse-item" href="/docs/apps/wstt/">Comunicación</a>
                    </div>
                </div>
            </li>

            <!-- Nav Item - Utilities Collapse Menu -->
            <li class="nav-item active">
                <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseUtilities"
                    aria-expanded="true" aria-controls="collapseUtilities">
                    <img src="../../../assets/img/icons/cpu.white.svg">
                    <span>Dispositivos</span>
                </a>
                <div id="collapseUtilities" class="collapse" aria-labelledby="headingUtilities"
                    data-parent="#accordionSidebar">
                    <div class="bg-white py-2 collapse-inner rounded">
                        <a class="collapse-item" href="/docs/devices/intro/">Introducción</a>
                        <a class="collapse-item" href="/docs/devices/mqtt/">Comunicación</a>
                    </div>
                </div>
            </li>

            <!-- Divider -->
            <hr class="sidebar-divider">

            <!-- Heading -->
            <div class="sidebar-heading">
                Herramientas
            </div>

            <!-- Nav Item - Pages Collapse Menu -->
            <li class="nav-item">
                <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapsePages"
                    aria-expanded="true" aria-controls="collapsePages">
                    <img src="../../../assets/img/icons/editor.white.svg">
                    <span>Editor</span>
                </a>
                <div id="collapsePages" class="collapse" aria-labelledby="headingPages" data-parent="#accordionSidebar">
                    <div class="bg-white py-2 collapse-inner rounded">
                        <a class="collapse-item" href="/docs/editor/intro/">Introducción</a>
                        <a class="collapse-item" href="/docs/editor/gui/">Interfaz</a>
                        <a class="collapse-item" href="/docs/editor/packaging/">Creación de paquetes</a>
                    </div>
                </div>
            </li>

            <!-- Nav Item - Charts -->
            <li class="nav-item">
                <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseDataLogger"
                    aria-expanded="true" aria-controls="collapseDataLogger">
                    <img src="../../../assets/img/icons/terminal.white.svg">
                    <span>Data Logger</span>
                </a>
                <div id="collapseDataLogger" class="collapse" aria-labelledby="headingPages" data-parent="#accordionSidebar">
                    <div class="bg-white py-2 collapse-inner rounded">
                        <a class="collapse-item" href="/docs/logger/intro/">Introducción</a>
                        <a class="collapse-item" href="/docs/logger/gui/">Interfaz</a>
                        <a class="collapse-item" href="/docs/logger/reports/">Generación de reportes</a>
                    </div>
                </div>
            </li>

            <!-- Divider -->
            <hr class="sidebar-divider d-none d-md-block">

            <!-- Sidebar Toggler (Sidebar) -->
            <div class="text-center d-none d-md-inline">
                <button class="rounded-circle border-0" id="sidebarToggle"></button>
            </div>
        </ul>
        <!-- End of Sidebar -->

        <!-- Content Wrapper -->
        <div id="content-wrapper" class="d-flex flex-column">

            <!-- Main Content -->
            <div id="content">

                <!-- Topbar -->
                <nav class="navbar navbar-expand navbar-light bg-white topbar mb-4 static-top shadow">

                    <!-- Sidebar Toggle (Topbar) -->
                    <button id="sidebarToggleTop" class="btn btn-link d-md-none rounded-circle mr-3">
                        <i class="fa fa-bars"></i>
                    </button>

                    <h3>Dispositivos - Cliente MQTT Python</h3>

                </nav>
                <!-- End of Topbar -->

                <!-- Begin Page Content -->
                <div class="container-fluid">

                    <!-- Page Heading -->
                    <div class="d-sm-flex align-items-center justify-content-between mb-4">
                        <h1 class="h3 mb-0 text-gray-800">Comunicación - MQTT</h1>
                    </div>

                    <!-- Content Row -->
                    <div class="row mx-2">
                        <p>
                            El cliente <a href="https://wiki.eclipse.org/Paho" target="_blank">Paho MQTT</a> de Eclipse se encuentra disponible para muchas plataformas y en diversos lenguajes de programación.
                            Lo que lo convierte en una alternativa muy buena para utilizar MQTT en proyectos de todo tipo.
                        </p>
                    </div>

                    <div class="d-sm-flex align-items-center justify-content-between mb-4">
                        <h1 class="h3 mb-0 text-gray-800">Obteniendo el API key</h1>
                    </div>

                    <!-- Content Row -->
                    <div class="row mx-2">
                        <p>
                            Para obtener el API key necesario es necesario con dirigirse a la <a href="/lab/devices/">pantalla de dispositivos</a> y registrar un dispositivo con el botón [+]
                        </p>
                    </div>

                    <!-- Content Row -->

                    <div class="row d-flex justify-content-center">
                        <img src="../../../assets/img/createDevice-screenshot.png" width="70%">
                    </div>


                    <div class="row mx-2">
                        <p>
                            Al presionar el botón se desplegará una ventana modal con el formulario de creación de dispositivo.
                        </p>
                    </div>

                    <div class="row d-flex justify-content-center">
                        <img src="../../../assets/img/createDeviceModal-screenshot.png" width="50%">
                    </div>
                    
                    <div class="row mx-2">
                        <p>
                            Por último debes copiar el API key utilizando el tercer botón en la tarjeta del dispositivo.
                        </p>
                    </div>

                    <div class="row d-flex justify-content-center">
                        <button class="btn btn-primary">
                            <img src="../../../assets/img/icons/copyApiKey.white.svg" width="30rem">
                        </button>
                    </div>


                    <div class="d-sm-flex align-items-center justify-content-between mb-4">
                        <h1 class="h3 mb-0 text-gray-800">Ejemplo de un dispositivo con una Raspberry y Python</h1>
                    </div>

                    <div class="row mx-2">
                        <p>
                            Materiales:
                        </p>
                    </div>

                    <div class="row mx-2">
                        <ul>
                            <li>Raspberry</li>
                            <li>MCP3008</li>
                            <li>LM35</li>
                            <li>RGB LED</li>
                            <li>LED</li>
                        </ul>
                    </div>

                    <div class="row mx-2">
                        <p>
                            El circuito a armar corresponde al del <a href="../../../assets/demo.pdf" download="demo.pdf">laboratorio demostrativo</a>. De modo que si buscas un documento más detallado lo puedes descargar en el enlace.
                            Sin embargo, la idea general es muy simple. Se trata de un laboratorio básico en el que se trata de publicar el estado de los LEDs desde la interfaz gráfica y la temperatura desde el dispositivo.
                        </p>
                    </div>

                    <div class="row d-flex justify-content-center">
                        <img src="../../../assets/img/circuito-demo.png" width="70%">
                    </div>

                    <div class="row mx-2">
                        <div>
                            <hr class="my-1">
                            <span class="lineNumber-3">1</span><span class="qml-p-keyword">import</span> paho.mqtt.client <span class="qml-p-keyword">as</span> mqtt <br>
                            <span class="lineNumber-3">2</span><span class="qml-p-keyword">from</span> time <span class="qml-p-keyword">import</span> sleep <br>
                            <span class="lineNumber-3">3</span><span class="qml-p-keyword">from</span> gpiozero <span class="qml-p-keyword">import</span> RGPLED, PWMLED, MCP3008 <br>
                            <span class="lineNumber-3">4</span><br>
                            <span class="lineNumber-3">5</span><span class="qml-variable">sensor</span> = MCP3008(channel = 0) <br>
                            <span class="lineNumber-3">6</span><span class="qml-variable">rgb</span> = RGBLED(17, 27, 22, active_high=<span class="qml-string">False</span>) <br>
                            <span class="lineNumber-3">7</span><span class="qml-variable">led</span> = PWMLED(23) <br>
                            <span class="lineNumber-3">8</span><br>
                            <span class="lineNumber-3">9</span><span class="qml-p-keyword">def</span> <span class="qml-function">onConnect</span> ( <span class="qml-arg">client</span>, <span class="qml-arg">userdata</span>, <span class="qml-arg">flags</span>, <span class="qml-arg">rc</span> ): <br>
                            <span class="lineNumber-2">10</span>    <span class="qml-function indent-1">print </span> ( &quot;<span class="qml-string">Connected</span>&quot; ) <br>
                            <span class="lineNumber-2">11</span>    <span class="qml-comment indent-1"># Subscribirse al los topics del RGB, red, green y blue</span> <br>
                            <span class="lineNumber-2">12</span>    <span class="qml-variable indent-1">client</span>.<span class="qml-function">subscribe</span> (&quot;<span class="qml-string">iotlabs/rgb/red</span>&quot;) <br>
                            <span class="lineNumber-2">13</span>    <span class="qml-variable indent-1">client</span>.<span class="qml-function">subscribe</span> (&quot;<span class="qml-string">iotlabs/rgb/green</span>&quot;) <br>
                            <span class="lineNumber-2">14</span>    <span class="qml-variable indent-1">client</span>.<span class="qml-function">subscribe</span> (&quot;<span class="qml-string">iotlabs/rgb/blue</span>&quot;) <br>
                            <span class="lineNumber-2">15</span>    <span class="qml-comment indent-1"># Subscribirse al topic del LED con PWM, pwm</span> <br>
                            <span class="lineNumber-2">16</span>    <span class="qml-variable indent-1">client</span>.<span class="qml-function">subscribe</span> (&quot;<span class="qml-string">iotlabs/pwm</span>&quot;) <br>
                            <span class="lineNumber-2">17</span>    <br>
                            <span class="lineNumber-2">18</span><span class="qml-p-keyword">def</span> <span class="qml-function">onMessage</span> ( <span class="qml-arg">client</span>, <span class="qml-arg">userdata</span>, <span class="qml-arg">message</span> ): <br>
                            <span class="lineNumber-2">19</span>    <span class="qml-comment indent-1"># Comparar el topic del mensaje recibido con el deseado</span> <br>
                            <span class="lineNumber-2">20</span>    <span class="qml-p-keyword indent-1">if</span> <span class="qml-variable">message.topic</span> == &quot;<span class="qml-string">iotlabs/rgb/red</span>&quot;: <br>
                            <span class="lineNumber-2">21</span>        <span class="qml-comment indent-2"># Decodificar el payload con el encoding UTF-8 para conviertirlo en string</span> <br>
                            <span class="lineNumber-2">22</span>        <span class="qml-p-keyword indent-2">if</span> <span class="qml-variable">message.payload</span>.<span class="qml-function">decode</span> (&quot;<span class="qml-string">utf-8</span>&quot;) == &quot;<span class="qml-string">on</span>&quot;: <br>
                            <span class="lineNumber-2">23</span>            <span class="qml-comment indent-3"># Encender el led Rojo del RGB</span> <br>
                            <span class="lineNumber-2">24</span>            <span class="qml-variable indent-3">rgb.value</span> = (1, <span class="qml-variable">rgb.value</span>[1], <span class="qml-variable">rgb.value</span>[2] ) <br>
                            <span class="lineNumber-2">25</span>        <span class="qml-p-keyword indent-2">else</span>: <br>
                            <span class="lineNumber-2">26</span>        <span class="qml-comment indent-3"># Apagar el led Rojo del RGB</span> <br>
                            <span class="lineNumber-2">27</span>            <span class="qml-variable indent-3">rgb.value</span> = (0, <span class="qml-variable">rgb.value</span>[1], <span class="qml-variable">rgb.value</span>[2] ) <br>
                            <span class="lineNumber-2">28</span>    <span class="qml-p-keyword indent-1">elif</span> <span class="qml-variable">message.topic</span> == &quot;<span class="qml-string">iotlabs/rgb/green</span>&quot;: <br>
                            <span class="lineNumber-2">29</span>        <span class="qml-p-keyword indent-2">if</span> <span class="qml-variable">message.payload</span>.<span class="qml-function">decode</span> (&quot;<span class="qml-string">utf-8</span>&quot;) == &quot;<span class="qml-string">on</span>&quot;: <br>
                            <span class="lineNumber-2">30</span>            <span class="qml-comment indent-3"># Encender el led Verde del RGB</span> <br>
                            <span class="lineNumber-2">31</span>            <span class="qml-variable indent-3">rgb.value</span> = (<span class="qml-variable">rgb.value</span>[0], 1, <span class="qml-variable">rgb.value</span>[2] ) <br>
                            <span class="lineNumber-2">32</span>        <span class="qml-p-keyword indent-2">else</span>: <br>
                            <span class="lineNumber-2">33</span>        <span class="qml-comment indent-3"># Apagar el led Verde del RGB</span> <br>
                            <span class="lineNumber-2">34</span>            <span class="qml-variable indent-3">rgb.value</span> = (<span class="qml-variable">rgb.value</span>[0], 0, <span class="qml-variable">rgb.value</span>[2] ) <br>
                            <span class="lineNumber-2">35</span>    <span class="qml-p-keyword indent-1">elif</span> <span class="qml-variable">message.topic</span> == &quot;<span class="qml-string">iotlabs/rgb/blue</span>&quot;: <br>
                            <span class="lineNumber-2">36</span>        <span class="qml-p-keyword indent-2">if</span> <span class="qml-variable">message.payload</span>.<span class="qml-function">decode</span> (&quot;<span class="qml-string">utf-8</span>&quot;) == &quot;<span class="qml-string">on</span>&quot;: <br>
                            <span class="lineNumber-2">37</span>            <span class="qml-comment indent-3"># Encender el led Azul del RGB</span> <br>
                            <span class="lineNumber-2">38</span>            <span class="qml-variable indent-3">rgb.value</span> = (<span class="qml-variable">rgb.value</span>[0], <span class="qml-variable">rgb.value</span>[1], 1 ) <br>
                            <span class="lineNumber-2">39</span>        <span class="qml-p-keyword indent-2">else</span>: <br>
                            <span class="lineNumber-2">40</span>            <span class="qml-comment indent-3"># Apagar el led Azul del RGB</span> <br>
                            <span class="lineNumber-2">41</span>            <span class="qml-variable indent-3">rgb.value</span> = (<span class="qml-variable">rgb.value</span>[0], <span class="qml-variable">rgb.value</span>[1], 0 ) <br>
                            <span class="lineNumber-2">42</span>    <span class="qml-p-keyword indent-1">elif</span> <span class="qml-variable">message.topic</span> == &quot;<span class="qml-string">iotlabs/pwm</span>&quot;: <br>
                            <span class="lineNumber-2">43</span>        <span class="qml-comment indent-2"># Modificar el ciclo de trabajo del LED con PWM al valor recibido en el payload</span> <br>
                            <span class="lineNumber-2">44</span>        <span class="qml-variable indent-2">led.value</span> = <span class="qml-function">float</span> ( <span class="qml-variable">message.payload</span> ) <br>
                            <span class="lineNumber-2">45</span>    <br>
                            <span class="lineNumber-2">46</span><span class="qml-comment"># Configurar el cliente</span> <br>
                            <span class="lineNumber-2">47</span><span class="qml-variable">deviceID</span> = &quot;<span class="qml-string">ID del dispositivo</span>&quot; <br>
                            <span class="lineNumber-2">48</span><span class="qml-variable">deviceAPIkey</span> = &quot;<span class="qml-string">API key del dispositivo</span>&quot; <br>
                            <span class="lineNumber-2">49</span><span class="qml-variable">client</span> = mqtt.<span class="qml-function">Client</span> ( <span class="qml-variable">deviceID</span> ) <br>
                            <span class="lineNumber-2">50</span><span class="qml-variable">client.on_connect</span> = onConnect <br>
                            <span class="lineNumber-2">51</span><span class="qml-variable">client.on_message</span> = onMessage <br>
                            <span class="lineNumber-2">52</span><br>
                            <span class="lineNumber-2">53</span><span class="qml-comment"># Conectarse al Broker</span> <br>
                            <span class="lineNumber-2">54</span><span class="qml-variable">client</span>.<span class="qml-function">connect</span> ( &quot;<span class="qml-string">imt-iotlabs.net</span>&quot; ) <br>
                            <span class="lineNumber-2">55</span><span class="qml-comment"># Proporcionar las credenciales al Broker</span> <br>
                            <span class="lineNumber-2">56</span><span class="qml-variable">client</span>.<span class="qml-function">username_pw_set</span> ( <span class="qml-variable">deviceID</span>, <span class="qml-variable">deviceAPIkey</span> ) <br>
                            <span class="lineNumber-2">57</span><br>
                            <span class="lineNumber-2">58</span><span class="qml-comment"># Iniciar el loop de eventos del cliente MQTT</span> <br>
                            <span class="lineNumber-2">59</span><span class="qml-variable">client</span>.<span class="qml-function">loop_start</span> () <br>
                            <span class="lineNumber-2">60</span><br>
                            <span class="lineNumber-2">61</span><span class="qml-comment"># Publicar las lecturas del sensor analógico LM35 conectado al canal 0 del MCP3008 en grados centígrados con un intervalo de 2 segundos</span> <br>
                            <span class="lineNumber-2">62</span><span class="qml-p-keyword">for</span> i <span class="qml-p-keyword">in</span> <span class="qml-function">range</span> ( 100 ): <br>
                            <span class="lineNumber-2">63</span>    <span class="qml-variable indent-1">client</span>.<span class="qml-function">publish</span> ( &quot;<span class="qml-string">iotlabs/temperature</span>&quot;, <span class="qml-function">str</span> ( <span class="qml-variable">sensor.value</span> * 3.3 * 100 ) ) <br>
                            <span class="lineNumber-2">64</span>    <span class="qml-function indent-1">sleep</span> (2) <br>
                            <span class="lineNumber-2">65</span><br>
                            <span class="lineNumber-2">66</span><span class="qml-variable">client</span>.<span class="qml-function">loop_stop</span> () <br>
                            <hr class="my-1">
                            Cliente MQTT de ejemplo
                            <hr class="my-1">
                        </div>
                    </div>

                </div>
                <!-- /.container-fluid -->

            </div>
            <!-- End of Main Content -->

            <!-- Footer -->
            <footer class="sticky-footer bg-white">
                <div class="container my-auto">
                    <div class="row">
                        <div class="col">
                            <div class="text-left">
                                <a href="/docs/devices/intro/">&leftarrow; Anterior</a>
                            </div>
                        </div>
                        <div class="col">
                            <div class="container">
                                <div class="copyright text-center my-auto">
                                    <span>Copyright &copy; IMT IoT Labs - 2020</span>
                                </div>
                            </div>
                        </div>
                        <div class="col">
                            <div class="text-right">
                                <a href="/docs/editor/intro/">Siguiente &rightarrow;</a>
                            </div>
                        </div>
                    </div>
                </div>
            </footer>
            <!-- End of Footer -->

        </div>
        <!-- End of Content Wrapper -->

    </div>
    <!-- End of Page Wrapper -->

    <!-- Scroll to Top Button-->
    <a class="scroll-to-top rounded" href="#page-top">
        <i class="fas fa-angle-up"></i>
    </a>

    <!-- Bootstrap core JavaScript-->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>

    <!-- Custom scripts for all pages-->
    <script src="../../js/sb-admin-2.min.js"></script>
</body>

</html>